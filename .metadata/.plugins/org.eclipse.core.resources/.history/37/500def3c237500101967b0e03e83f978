package order;

import java.time.Instant;
import java.util.UUID;

import org.springframework.amqp.rabbit.core.RabbitTemplate;
import org.springframework.stereotype.Component;

import config.OrderQueues;
import events.OrderEventDto;

@Component
public class OrderEventPublisher {

	private final RabbitTemplate rabbitTemplate;

	public OrderEventPublisher(RabbitTemplate rabbitTemplate) {
		this.rabbitTemplate = rabbitTemplate;
	}
	
	public void publishOrderCreatedEvent(Long orderId, String correlationId) {
		OrderEventDto dto = new OrderEventDto();
		dto.setEventId(UUID.randomUUID().toString());
		dto.setOrderId(orderId);
		dto.setEventType("CREATED");
		dto.setSource("ORDER");
		dto.setCorrelationId(correlationId);
		dto.setOccuredAt(Instant.now());
		rabbitTemplate.convertAndSend(OrderQueues.ORDER_CREATED, dto);
		System.out.println("Sent event: ORDER_CREATED for ID = " + orderId);
	}
	
	
	
}
