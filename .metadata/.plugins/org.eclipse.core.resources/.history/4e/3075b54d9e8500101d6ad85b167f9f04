package notification;

import org.junit.jupiter.api.Test;
import org.mockito.ArgumentCaptor;
import org.springframework.mail.SimpleMailMessage;
import org.springframework.mail.javamail.JavaMailSender;

import notification.EmailService;

import static org.junit.jupiter.api.Assertions.*;
import static org.mockito.Mockito.*;

public class EmailServiceTest {

	 	@Test
	    void sendDeliveredEmail_buildsMessage_andCallsMailSender() {
	        JavaMailSender sender = mock(JavaMailSender.class);
	        EmailService service = new EmailService(sender);

	        String to = "user@example.com";
	        String subject = "subj";
	        String body = "body";

	        service.sendDeliveredEmail(to, subject, body);

	        ArgumentCaptor<SimpleMailMessage> cap = ArgumentCaptor.forClass(SimpleMailMessage.class);
	        verify(sender).send(cap.capture());

	        SimpleMailMessage msg = cap.getValue();
	        assertArrayEquals(new String[]{to}, msg.getTo());
	        assertEquals(subject, msg.getSubject());
	        assertEquals(body, msg.getText());
	        assertEquals("andrejatestmejl@gmail.com", msg.getFrom()); // hardkodirani from iz servisa
	    }
}
