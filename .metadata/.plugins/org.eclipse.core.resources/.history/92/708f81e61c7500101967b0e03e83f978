package notification;

import org.springframework.amqp.rabbit.annotation.RabbitListener;
import org.springframework.stereotype.Component;

import config.OrderQueues;
import events.OrderEventDto;

@Component
public class NotificationListener {

	   private final EmailService emailService;
	   
	   private static final String DEMO_EMAIL = "andrejatestmejl@gmail.com";

	    public NotificationListener(EmailService emailService) {
	        this.emailService = emailService;
	    }

	    @RabbitListener(queues = OrderQueues.ORDER_DELIVERED)
	    public void handleDelivered(OrderEventDto delivered) {
	        System.out.println("[NOTIFICATION] Received delivered for orderId=" + delivered.getOrderId()
	                + " corrId=" + delivered.getCorrelationId());

	        String subject = "Your order " + delivered.getOrderId() + " has been delivered!";
	        String body =
	                "Hello,\n\n" +
	                "Your order has just been delivered.\n" +
	                "Order ID: " + delivered.getOrderId() + "\n" +
	                "Processed via correlationId: " + delivered.getCorrelationId() + "\n\n" +
	                "Thanks for choosing us!";

	        emailService.sendDeliveredEmail(DEMO_EMAIL, subject, body);
	        System.out.println("[NOTIFICATION] Email sent to " + DEMO_RECIPIENT + " for orderId=" + delivered.getOrderId());
	    }
}
